<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book Parking Spot - ParkEase</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- Leaflet OpenStreetMap CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Leaflet OpenStreetMap JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>

    <style>
        /* Inline style if needed */
        #map {
            width: 100%;
            height: 400px;
            margin-top: 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="booking-container">
        <h1>Book a Parking Spot</h1>

        <form action="{{ url_for('search_parking') }}" method="POST" class="booking-form">
            <input type="text" name="location" placeholder="Book parking near..." required><br>

            <label>Enter After:</label>
            <input type="datetime-local" name="entry_time" required><br>

            <label>Exit Before:</label>
            <input type="datetime-local" name="exit_time" required><br>

            <label>Booking Type:</label>
            <select name="booking_type" required>
                <option value="hourly">Hourly</option>
                <option value="monthly">Monthly</option>
            </select><br>

            <input type="submit" value="Search Parking">
        </form>

        <!-- Map -->
        <div id="map"></div>

        <!-- Parking results (we will dynamically fill this later) -->
        <div class="parking-results">
            <h2>Available Parking Spots (Coming Soon)</h2>
        </div>
    </div>

    <script>
        // Initialize the map
        var map = L.map('map').setView([23.8103, 90.4125], 13); // Default: Dhaka, Bangladesh
    
        // Load OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
    
        // Try to locate the user
        map.locate({ setView: true, maxZoom: 16 });
    
        // Handle found location
        function onLocationFound(e) {
            var radius = e.accuracy;
    
            L.marker(e.latlng).addTo(map)
                .bindPopup("You are here").openPopup();
            
            L.circle(e.latlng, radius).addTo(map);
    
            // Add dummy parking spots nearby
            addDummyParkingSpots(e.latlng.lat, e.latlng.lng);
        }
    
        // Handle location error
        function onLocationError(e) {
            alert(e.message);
        }
    
        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);
    
        // Dummy parking spots
        function addDummyParkingSpots(lat, lng) {
            // Dummy spots around your location
            const spots = [
                {
                    name: "City Center Parking",
                    price_hourly: "৳50/hr",
                    coords: [lat + 0.002, lng + 0.002]
                },
                {
                    name: "Basundhara Parking Lot",
                    price_hourly: "৳60/hr",
                    coords: [lat - 0.002, lng - 0.001]
                },
                {
                    name: "Gulshan Plaza Parking",
                    price_hourly: "৳70/hr",
                    coords: [lat + 0.0015, lng - 0.0025]
                },
                {
                    name: "Dhanmondi Lake Parking",
                    price_hourly: "৳55/hr",
                    coords: [lat - 0.001, lng + 0.001]
                }
            ];
    
            spots.forEach(spot => {
    L.marker(spot.coords).addTo(map)
        .bindPopup(`
            <b>${spot.name}</b><br>
            Rate: ${spot.price_hourly}<br>
            <form action="/confirm-booking" method="POST">
                <input type="hidden" name="spot_name" value="${spot.name}">
                <input type="hidden" name="price" value="${spot.price_hourly.replace('৳', '').replace('/hr', '')}">
                <input type="hidden" name="booking_type" value="hourly">
                <input type="hidden" name="entry_time" value="${new Date().toISOString()}">
                <input type="hidden" name="exit_time" value="${new Date(new Date().getTime() + 2*60*60*1000).toISOString()}"> <!-- 2 hours later -->
                <input type="submit" value="Book Now">
            </form>
        `);
});

        }
    </script>
    
</body>
</html>
